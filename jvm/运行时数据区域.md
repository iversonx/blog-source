---
title: 运行时数据区域
date: 2019-06-28
categories: java
tags: 学习笔记
description: 
---

JVM定义了在程序执行期间使用的各种运行时数据区域。其中一些数据区域是在JVM启动时创建，仅在JVM退出时销毁。其他数据区域是每个线程的，线程数据区域随着线程的开始而创建，在线程结束时销毁。

## pc寄存器(pc Program counter)

用于保存JVM正在执行的字节码指令的地址。如果执行的是`native`方法，pc寄存器的值为`undefined`。



字节码解释器工作时通过改变这个计数器的值来选取下一条需要执行的字节码指令。

pc寄存器属于线程数据区域，因此其生命周期与线程相同。



## JVM栈(Java Virtual Machine Stacks)

线程在创建的同时，jvm会创建于线程对应的jvm栈，用于存储栈帧。



方法在执行的同时会创建一个栈帧用于存储局部变量表、操作数栈等信息。方法从调用到执行完成，对应着栈帧在jvm栈中入栈到出栈。



JVM栈也属于线程数据区域，其使用的内存空间可以不是连续的。



JVM栈的空间大小可以是固定的，也可以是动态扩容的。

如果是固定大小的栈，当线程请求分配的栈容量超过jvm允许的最大容量，jvm将抛出`StackOverflowError`异常。

如果jvm栈可以动态扩容，当扩展时无法申请到足够的内存或在新建线程没有足够的内存去创建对应的jvm栈时，jvm抛出`OutOfMemoryError`异常。



## 堆(Heap)

在jvm中，java堆是线程共享的运行时内存区域，在jvm启动时创建。用于存放类实例和数组对象。



java堆是垃圾收集器管理的主要区域。java堆的内存空间不是连续的，但在逻辑上是连续的。



java堆的容量可以是固定的，也可以随着程序执行动态扩展，但不会自动收缩。



如果堆中没有足够的内存完成实例分配，并且无法再扩展时，会抛出`OutOfmemoryError`异常。



## 方法区(Method Area)

方法区是线程共享的运行时内存区域，存储了每一个类的结构信息。
