---
title: Web 服务器
date: 2018-12-14
categories: http
tags: 学习笔记
description: 
---

## Web 服务器的实现

Web服务器逻辑实现了HTTP协议、管理Web资源，并负责提供Web服务器的管理功能。Web 服务器逻辑和操作系统共同负责管理TCP连接。操作系统复杂管理底层计算机系统的硬件细节，并提供了TCP/IP网络支持、复杂装载Web资源的文件系统以及控制当前计算活动的进程管理功能。

## Web服务器必须执行的几项任务

### 接收客户端连接

客户端请求一条到Web服务器的TCP连接时，Web服务器会建立连接，判断连接的另一端是哪个客户端，从TCP连接中将IP地址解析出来。一旦新连接建立起来并被接受，服务器会将新连接添加到连接列表中，做好监视连接上数据传输的准备。

Web服务器可以随意拒绝后立即关闭任意一条连接。有的服务器会因为客户端IP地址或主机名是未认证的，或者因为它是已知的恶意客户而关闭连接。Web服务器也可使用其他识别技术

#### 客户端主机名识别

可以用"反向DNS"对大部分Web服务器进行配置，以便将客户端IP地址转换成客户端主机名。Web服务器可以将客户端主机名用于详细的访问控制和日志记录。但要注意的是，主机名查找可能花费很长时间，这样会降低Web事务处理的速度。

#### 通过ident确定客户端用户

也可以通过ident协议找到发起HTTP连接的用户名。这些信息对Web服务器的日志记录特别有用——流行的通用日志格式的第二个字段就包含了每条HTTP请求的ident用户名。

如果客户端支持ident协议，就在TCP端口113上监听ident请求。ident协议工作原理：客户端打开一条HTTP连接，然后服务器打开自己到客户端ident服务器端口113的连接，发送一条简单的请求，询问与新连接相对应的用户名，并从客户端解析出包含用户名的响应。

ident在internet不能很好工作的原因：

- 很多客户端没有允许ident识别协议守护进程软件；

- ident协议会使HTTP事务处理产生严重的时延

- 很多防火墙不允许ident流量进入

- ident协议不安全，容易被伪造

- ident协议不支持虚拟IP

- 暴露客户端的用户名还涉及隐私问题。

### 接收请求消息

连接上有数据到达时，Web服务器会从网络连接中读取数据，并将请求消息中的内容解析出来。解析请求消息时，Web服务器会：

- 解析请求行，查找请求方法，指定的资源标识符(URI)以及版本号，各项之间由一个空格分隔，并以一个回车换行序列作为行的结束；

- 读取以CRLF结尾的消息头；

- 检测到以CRLF结尾的、标识头部结束的空行；

- 如果有的话，读取请求主体。

### 处理请求

待完善

### 对资源映射和访问



### 构建响应

### 发送响应

### 记录日志
