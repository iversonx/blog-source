---
title: 创建型模式 -- 工厂方法模式
date: 2018-10-25
categories: 设计模式
tags: 学习笔记

description: 定义一个用于创建对象的接口，让子类决定实例化哪个类，工厂方法使一个类的实例化延迟到其子类
---

#### 一、什么是工厂方法模式

##### 1. 定义

定义一个用于创建对象的接口，让接口的子类决定实例化哪个具体类，Factory Method 使一个类的实例化延迟到接口子类中完成。

##### 2. 结构和说明

[示意图]

- Product：定义工厂方法所创建的对象的接口，即实际需要使用的对象的接口。

- Concreteproduct：具体的Product接口的实现对象。

- Creator：创建器，声明工厂方法，工厂方法通常会返回一个Product类型的实例对象，通常是抽象方法。

- ConcreteCreator：具体的创建器对象，返回具体的Product实例。

##### 3. 示例代码

```java
public interface Product {

}

public class ConcreteProduct implements Product {

}

public abstract class Creator {
    protected abstract Product factoryMethod();
    public void someOperation() {
        // 其他操作，
    }
}

public class ConcreteCreator extends Creator {
    protected Product factoryMethod() {
        return new ConcreteProduct();
    }
}
```

#### 二、工厂方法的一些细节

##### 1. 工厂方法模式的功能

工厂方法模式的主要功能是让父类在不知道具体实现的情况下，完成自身的功能调用；而具体的实现延迟到子类来实现。

##### 2. 工厂方法的实现

###### 实现成抽象类

工厂方法的实现中，通常父类会是一个抽象类，里面包含创建所需对象的抽象方法，这些抽象方法就是工厂方法。

> 子类在实现抽象方法时，通常并不是由子类来实现具体的功能，而是在子类的方法中选择具体的具体产品实现对象。

###### 实现成具体类

也可以把工厂方法的父类实现成一个具体的类。这种情况下，通常是在父类中提供获取所需对象的默认实现方法，这样即使没有具体的子类，也能够运行。

##### 3. 谁来使用工厂方法创建的对象

在工厂方法模式里面，应该是Creator中的其他地方在使用工厂方法创建的对象，也可以把工厂方法创建的对象直接提供给Creator外部使用，但工厂方法模式的本意，是前者。

##### 4. 工厂方法模式与Ioc/DI的关系

从思想层面上，会发现工厂方法模式和Ioc/DI的思想是相似的，都是“主动变被动”进行了“主从换位”，从而获得了更灵活的程序结构。

IoC/DI示例代码

```java
public class A {
    private C c = null;
    public void set(C c) {
        this.c = c;
    }

    public void t1() {
        // 这里需要使用c，可是又不主动创建C
        // 需要外部注入，自己只管使用就好了。
        c.tc();
    }
}

public interface C {
    public void tc();
}
```

工厂方法示例代码

```java
public abstract class A1() {
    protected abstract C1 createC1();
    public void t1() {
        // 这里需要使用C1，也不主动创建C1
        // 延迟到子类里面实现
        C1 c = createC1();
        c.tc();
    }
}

public class A2 extends A1 {
    protected C1 createC1() {
        return new C2();
    }
}
```

#### 三、工厂方法模式的优缺点

##### 优点

- 可以在不知道具体实现的情况下编程

  工厂方法模式可以让你在实现功能的时候，如果需要某个产品对象，只需要使用产品接口即可，而无需关心具体的实现。选择具体实现的人延迟到子类去完成。

- 更容易扩展对象的新版本

  工厂方法为子类提供了一个挂钩，使得扩展新的对象版本变得容易。只要新加入一个子类来提供新的工厂方法实现，然后在客户端使用这个新的子类即可。

##### 缺点

- 具体产品对象和工厂方法的耦合性

  在工厂方法模式中，工厂方法需要选择具体的产品对象，并创建它们的实例，因此具体产品对象和工厂方法是耦合的。

#### 四、何时选用工厂方法模式

- 如果一个类需要创建某个接口的对象，但是又不知道具体的实现，这种请求可以选用工厂方法模式，把创建对象的工作延迟到子类中去实现。

- 如果一个类本身就希望由它的子类来创建所需的对象的时候，可以使用工厂方法模式。

#### 五、总结

1. 工厂方法模式的本质：延迟到子类来选择实现。工厂类里面使用工厂方法的地方是依赖于抽象而不是具体实现，从而使得系统更加灵活，具有更好的可维护性和可扩展性。

2. 工厂方法模式很好地体现了“依赖倒转原则”。

#### 六、相关模式

- 工厂方法模式和模板方法模式

  这两个模式外观类似，都有个抽象类，然后由子类提供实现。工厂方法模式专注的是创建产品对象，而模版方法模式专注的为固定的算法骨架提供某些步骤的实现。
