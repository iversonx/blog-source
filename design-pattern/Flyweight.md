---
title: 享元模式(Flyweight)
date: 2018-10-26
categories: 设计模式
tags: 学习笔记
description: 
---
#### 一、什么是享元模式

##### 1. 定义
运行共享技术有效地支持大量细粒度的对象。

##### 2. 应用享元模式的思路

##### 3. 结构和说明 
[结构图]

- Flyweight：享元接口，通过这个接口可以接受并作用于外部状态。通过这个接口传入外部的状态，在享元对象的方法处理中可能会使用这些外部的数据。
- ConcreteFlyweight：具体的享元对象，必须是可共享的。需要封装Flyweight的内部状态。
- UnsharedConcreteFlyweight：非共享的享元实现对象，并不是所有的Flyweight实现对象都需要共享。非共享的享元实现对象通常是对共享享元对象的组合对象。
- FlyweightFactory：享元工厂，主要用来创建并管理共享的享元对象，并对外提供访问共享享元的接口。
- Client：客户端，主要的工作是维持一个对Flyweight的引用，计算或存储享元对象的外部状态。

##### 4. 变与不变
享元模式设计的重点就在于分离变与不变。把一个对象的状态分成内部状态(不变)和外部状态(可变)。然后通过共享不变的部分，达到减少对象数量并节约内存的目的。

##### 5. 内部状态和外部状态
内部状态通常指包含在享元对象内部的、对象本身的状态，是独立于使用享元的场景的信息，一般创建后就不再变化的状态，因此可以共享。

外部状态指的是享元对象之外的状态，取决于使用享元的场景，会根据使用场景而变化，因此不可共享。

所以享元模式真正缓存和共享的数据是享元的内部状态，而外部状态是不应该被缓存共享的。

##### 6. 实例池
在享元模式中，为了创建和管理共享的享元部分，引入了享元工厂。工厂中一般包含有享元对象的实例池，享元对象就是缓存在这个实例池中的。

##### 7. 享元模式的调用顺序
[示意图]

1. 通过享元工厂来获取共享的享元对象；如果没有，就创建相应的享元对象；
2. 调用共享的享元对象的方法，传入外部状态。



#### 二、享元模式的优缺点
##### 优点
- 减少对象数量，节省内存空间

##### 缺点
- 维护共享对象，需要额外开销

#### 三、何时选用享元模式
- 如果一个应用程序使用了大量的细粒度对象，可以使用享元模式来减少对象数量。
- 如果由于使用大量的对象，造成很大的存储开销，可以使用享元模式来减少对象数量，并节约内存。
- 如果对象的大多数状态都可以转变为外部状态，比如通过计算得到，或是从外部传入等，可以使用享元模式来实现内部状态和外部状态的分离。
- 如果不考虑对象的外部状态，可以用相对较少的共享对象取代很多组合对象，可以使用享元模式来共享对象，然后组合对象来使用这些共享对象。




