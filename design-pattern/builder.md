---
title: 创建型模式--构建者模式
date: 2018-10-26
categories: 设计模式
tags: 学习笔记
description: 将一个复杂对象的构建与它的表示分类，使得同样的构建过程可以创建不同的表示。
---

#### 一、什么是构建者模式

##### 1. 定义

将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。

##### 2. 应用构建者模式解决问题的思路

先把构建过程独立出来，在构建者模式中把它称为指导者，由它来指导装配过程，但是不负责每步具体的实现。接着定义具体实现每一步的对象，在构建者模式中称为生成器。指导者就是可以重用的构建过程，而生成器是可以被切换的具体实现。

##### 3. 结构和说明

[示意图]

- Buidler：生成器接口，定义创建一个Product对象所需的各个部件的操作。

- ConcreteBuilder：具体的生成器实现，实现各个部件的创建，并负责组装Product对象的各个部件，还提供一个让用户获取组装完成后的产品对象的方法。

- Director：指导者，主要用来使用Builder接口，以一个统一的过程来构建所需要的Product对象。

- Product：产品，表示被生成器构建的复杂对象，包含多个部件。

##### 4. 示例代码

```java
// 生成器接口,定义创建一个产品对象所需的各个部件的操作
public interface Builder {
    public void buildPart();
}

// 被构建的产品对象的接口
public interface Product {
}

public class ConcreteBuilder implements Builder {
    // 生成器最终构建的产品对象
    private Product resultProduct;

    public Product getResult() {
        return resultProduct;
    }

    public void buildPart() {
        // 构建某个部件的功能处理
    }
}

public class Director {
    private Builder builder;
    public Director(Builder builder) {
        this.builder = builder;
    }

    public void construct() {
        builder.buildPart();
    }
}
```

#### 二、构建者模式的一些细节

构建者模式的主要功能是细化的、分步骤的构建复杂产品。其重心在分离构建算法和具体的构造实现，从而使得构建算法可以重用。

##### 构建者模式的构成

构建者模式分成两个很重要的部分。

- 一个部分是Builder接口，在Builder接口中定义了具体的构造实现。

- 另一个部分是Director，复杂整体的构建算法。

在Director实现整体构建算法的时候，遇到需要创建和组合具体部件时，会把这些功能通过委托交给Builder来完成。

##### 生成器模式的使用

应用生成器模式时，可以让客户端创建Director，在Director里面封装整体构建算法，然后让Director调用Builder，让Builder来封装具体部件的构建功能；或者让客户端和Director融合起来，让客户端直接去操作Builder。

##### Builder的实现

在Builder接口的实现中，每个部件构建的方法里面可以有两部分功能， 一部分是创建部件对象，另一部分是组装部件。在构建部件的方法里可以实现选择并创建具体的部件对象，然后再把这个部件对象组装到产品对象中去。

##### Director的实现

Director承担的是整体构建算法，是相对不变的部分。因此在实现指导者的时候，把变化的部分分离出去是很重要的。

##### Director和Builder的交互

在示例代码中，Director和Builder的交互是通过Builder的buildPart方法来完成的。实际开发中Director通常会实现比较复杂的算法或运算过程，在实际中很可能会有以下情况：

- 运行Director的时候，按照整体构建算法进行运算，可能先运行前几步，到了某一个步骤，需要具体创建某个部件对象，就调用Builder来创建具体部件，并把前面运算得到的数据传递给Builder。

- Builder创建完具体的部件对象后，会把创建好的部件对象返回给指导者，指导者继续后续的算法运行。

- 如此反复，直到整个构建算法运行完成，那么最终的产品对象也就创建好了。

#### 三、构建者模式的优缺点

- 松散耦合

  构建者模式把产品构建的过程独立出来，使它和具体产品的表现松散耦合，从而使得构建算法可以复用，而具体产品表现也可以灵活地、方便地扩展和切换。

- 可以很容易地改变产品的内部表示

  在构建者模式中具体的部件创建和装配方式被Builder接口隐藏了，Director并不知道这些具体的实现细节，因此要想改变产品的内部表示，只需要切换Builder的具体实现即可。

- 更好的复用性

  构建者模式很好地实现了构建算法和具体产品实现的分离，使得构建产品的算法和具体产品的实现都可以复用。

#### 四、何时选用构建者模式

- 需要生成的对象具有复杂的内部结构，这些对象通常包含多个成员属性。

- 需要生成的对象的属性相互依赖，需要指定其生成顺序。

#### 五、总结

- 构建者模式将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。构建者模式是一步步创建一个复杂的对象，允许用户只通过指定复杂对象的类型和内容就可以构建它们，用户不需要知道内部的具体构建细节。构建者模式是对象创建型模式的一种。

- 构建者包含了四个角色：Builder为创建一个产品对象的各个部件指定抽象接口；ConcreteBuilder实现了Builder定义的接口；Director负责使用Builder接口，以一个统一的过程来构建所需要的Product对象；Product是被构建的复杂对象。

#### 六、相关模式

- 构建者模式和工厂方法模式

  这两个模式可以组合使用。构建者模式的Builderh实现中，通常需要选择具体的部件实现。这里可以实现成工厂方法，通过工厂方法来获取具体的部件对象，然后再进行部件的装配。

- 构建者模式和抽象工厂模式

  这两个模式即相似又有区别。如果在实现Builder时，只有创建对象的功能，而没有组装的功能，这种情况，Builder接口就类似于抽象工厂的接口，Builder的具体实现类似具体的工厂。

  抽象工厂模式的主要目的是创建产品簇，这个产品簇里面的单个产品就相当于是构成一个复杂对象的部件对象；构建者模式主要目的是按照构造算法一步步来构建一个复杂的产品对象。
